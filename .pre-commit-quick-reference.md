# Pre-commit Hooks Quick Reference

## 🚀 Installation (One-Time Setup)

```bash
# Automated installation (recommended - choose your platform)
./scripts/setup-precommit.sh           # Linux/macOS
scripts\setup-precommit.bat            # Windows
python scripts/setup-precommit.py      # Any platform

# OR manual installation
pip install pre-commit
pre-commit install
pre-commit install --hook-type commit-msg
detect-secrets scan --baseline .secrets.baseline
```

## 📋 Security Hooks Summary

| Hook | Priority | What It Catches | Action If Failed |
|------|----------|----------------|------------------|
| **detect-secrets** | 🔴 CRITICAL | API keys, passwords, tokens | Remove secret, use env vars |
| **gitleaks** | 🔴 CRITICAL | 100+ secret patterns, cloud creds | Remove & rotate credential |
| **check-github-workflows** | 🟠 HIGH | GitHub Actions syntax errors | Fix workflow YAML |
| **bandit** | 🟠 HIGH | Python security vulnerabilities | Fix security issue |

## 🐍 Python Quality Hooks

| Hook | Purpose | Fixes |
|------|---------|-------|
| **black** | Code formatting | Auto-formats code |
| **isort** | Import sorting | Auto-sorts imports |
| **flake8** | Linting | Shows errors (manual fix) |
| **mypy** | Type checking | Shows type errors (manual fix) |

## ⚡ Common Commands

```bash
# Run hooks manually (without committing)
pre-commit run --all-files

# Run specific hook only
pre-commit run detect-secrets --all-files
pre-commit run black --all-files

# Update all hooks to latest versions
pre-commit autoupdate

# Skip hooks (EMERGENCY ONLY - not recommended)
git commit --no-verify -m "emergency fix"
SKIP=flake8 git commit -m "wip"

# Fix auto-formattable issues
pre-commit run --all-files black isort trailing-whitespace

# Audit secrets baseline
detect-secrets audit .secrets.baseline
```

## 🔥 Quick Fixes for Common Failures

### Secret Detected
```python
# ❌ BEFORE (fails)
API_KEY = "sk-1234567890abcdef"

# ✅ AFTER (passes)
API_KEY = os.getenv("API_KEY")
```

### GitHub Workflow Error
```yaml
# ❌ BEFORE (fails)
jobs:
  test:
    step:  # Wrong key
      - uses: actions/checkout@v4

# ✅ AFTER (passes)
jobs:
  test:
    steps:  # Correct key
      - uses: actions/checkout@v4
```

### Black Formatting
```bash
# Auto-fix formatting issues
black src/ tests/
git add .
git commit -m "style: format code with black"
```

### Flake8 Linting
```python
# ❌ BEFORE (fails)
import os,sys  # Multiple imports on one line

def foo( x,y ):  # Bad spacing
    unused_var = 5  # Unused variable

# ✅ AFTER (passes)
import os
import sys

def foo(x, y):
    return x + y
```

## 📊 Performance Tips

```bash
# Only run on changed files (default)
git commit -m "message"

# Run all hooks but only on staged files
pre-commit run

# Clear pre-commit cache if hooks are slow
pre-commit clean
pre-commit install
```

## 🚨 Emergency Procedures

### Need to commit urgently (production down)
```bash
# 1. Commit with --no-verify (bypass hooks)
git commit --no-verify -m "hotfix: critical production fix"

# 2. Create immediate follow-up PR to fix issues
# 3. Run hooks on next commit:
pre-commit run --all-files
# Fix all issues
git commit -m "fix: resolve pre-commit issues from hotfix"
```

### False Positive in Secret Detection
```bash
# 1. Audit the detection
detect-secrets audit .secrets.baseline

# 2. Mark as false positive in the interactive audit
# Press 'n' for false positive, 'y' for real secret

# 3. Update baseline
detect-secrets scan --baseline .secrets.baseline

# 4. Commit the updated baseline
git add .secrets.baseline
git commit -m "chore: update secrets baseline"
```

## 📈 Success Metrics

After implementing pre-commit hooks, you should see:

- ✅ 0 secrets leaked to repository
- ✅ 80%+ reduction in CI failures
- ✅ Faster code reviews (no style discussions)
- ✅ Consistent code formatting across team
- ✅ Fewer security vulnerabilities

## 🔗 Quick Links

- [Full Setup Guide](docs/PRE_COMMIT_SETUP.md)
- [Pre-commit Docs](https://pre-commit.com/)
- [detect-secrets](https://github.com/Yelp/detect-secrets)
- [Gitleaks](https://github.com/gitleaks/gitleaks)

---

**💡 Pro Tip:** Run `pre-commit run --all-files` before opening a PR to catch all issues early!
